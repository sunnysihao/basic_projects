# _*_ coding=: utf-8 _*_
import os
import json
from numpy.linalg import inv


camex0 = [[0.72060836625603331,-0.69110801912994047,0.055617338808156454,-2.8044749334116861],
          [0.033392304907282511,-0.045529554316574718,-0.99840473439217725,1.58158812176727],
          [0.692537750923941,0.721315995648249,-0.0097312880537772876,-4.5149259410305183],
          [0.0,0.0,0.0,1.0]]
ext0 = inv(camex0).flatten().tolist()

camex1 = [[0.0082514009000863586,-0.99981294697541157,0.017492439610554186,-0.055110227319120839],
          [-0.0061868740418561845,-0.017543744616984464,-0.99982695483488748,2.4197841049562658],
          [0.99994681707217636,0.0081417495144998631,-0.0063304772384774437,-4.8894187618054],
          [0.0,0.0,0.0,1.0]]
ext1 = inv(camex1).flatten().tolist()

camex2 = [[-0.69732376936695672,-0.71662754477589052,0.013583914912084214,2.5514936871018365],
         [0.0045457116741149549,-0.023373224269166888,-0.999716474252895,1.6958117442415857],
         [0.71674186230555537,-0.69706431156367676,0.019556287045914816,-4.6968149078614623],
         [0.0,0.0,0.0,1.0]]
ext2 = inv(camex2).flatten().tolist()

camex3 = [[-0.72597481487954219,0.68619377525878034,-0.045811253603423648,4.6571404801336467],
          [0.032766676826955783,-0.032025008400315427,-0.99894982042476888,1.5270026091234934],
          [-0.68694025435283135,-0.72671349349868442,0.00076505987036157416,2.4098880400861273],
          [0.0,0.0,0.0,1.0]]
ext3 = inv(camex3).flatten().tolist()

camex4 = [[0.67433412308787755,0.73829218351322778,0.014076299320964861,-4.3978140864515449],
         [0.027310682767936141,-0.0058861797318254545,-0.9996096635661913,1.5566178766615231],
         [-0.73792114554744415,0.67445533925637735,-0.024132515461774754,2.7176769024483352],
         [0.0,0.0,0.0,1.0]]
ext4 = inv(camex4).flatten().tolist()


data = {
            "3d_img0": {
                "camera_internal": {
                    "fx": 1234.889846157685,
                    "cx": 1474.819736455416,
                    "cy": 939.08273111080223,
                    "fy": 1234.6910373827659
                },
                "camera_external": ext0
            },
            "3d_img1": {
                "camera_internal": {
                    "fx": 1712.693927215747,
                    "cx": 1702.904523763543,
                    "cy": 1050.4239899553529,
                    "fy": 1714.2999963591831
                },
                "camera_external": ext1
            },
            "3d_img2": {
                "camera_internal": {
                    "fx": 1228.789167684733,
                    "cx": 1517.6960752719269,
                    "cy": 892.03072311225981,
                    "fy": 1228.710771568929
                },
                "camera_external": ext2
            },
            "3d_img3": {
                "camera_internal": {
                    "fx": 1237.4927868441271,
                    "cx": 1436.124740754439,
                    "cy": 958.70146404020454,
                    "fy": 1237.566653354852
                },
                "camera_external": ext3
            },
            "3d_img4": {
                "camera_internal": {
                    "fx": 1226.4142739924921,
                    "cx": 1408.643721165841,
                    "cy": 1226.030548191123,
                    "fy": 914.59079565734635
                },
                "camera_external": ext4
            }
        }

def list_files(in_path: str):
    file_list = []
    for root, _, files in os.walk(in_path):
        for file in files:
            file_name = os.path.splitext(file)[0]
            file_list.append(file_name)
    return file_list

def write_param(pcd_path, output_path):
    for file in list_files(pcd_path):
        with open(os.path.join(output_path, file + '.json'), 'w', encoding='utf-8') as f:
            f.write(json.dumps(data))

if __name__ == "__main__":
    pcd_path = r"D:\Desktop\BasicProject\任从辉\倍赛0617\3d_url"
    output_path = r"D:\Desktop\BasicProject\任从辉\倍赛0617\camera_config"
    write_param(pcd_path, output_path)
